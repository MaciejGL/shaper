type MealPlan {
  id: ID!
  title: String!
  description: String
  completedAt: String

  isPublic: Boolean!
  isTemplate: Boolean!
  isDraft: Boolean!
  active: Boolean!
  startDate: String
  endDate: String

  dailyCalories: Float
  dailyProtein: Float
  dailyCarbs: Float
  dailyFat: Float

  createdBy: UserPublic
  assignedTo: UserPublic
  weeks: [MealWeek!]!

  weekCount: Int!
  assignedCount: Int!

  createdAt: String!
  updatedAt: String!
}

type MealWeek {
  id: ID!
  weekNumber: Int!
  name: String!
  description: String
  completedAt: String
  isExtra: Boolean!

  days: [MealDay!]!
  plan: MealPlan

  # Calculated fields
  totalCalories: Float!
  totalProtein: Float!
  totalCarbs: Float!
  totalFat: Float!
}

type MealDay {
  id: ID!
  dayOfWeek: Int!
  completedAt: String
  scheduledAt: String

  targetCalories: Float
  targetProtein: Float
  targetCarbs: Float
  targetFat: Float

  meals: [Meal!]!
  week: MealWeek

  # Calculated fields
  actualCalories: Float!
  actualProtein: Float!
  actualCarbs: Float!
  actualFat: Float!
  plannedCalories: Float!
  plannedProtein: Float!
  plannedCarbs: Float!
  plannedFat: Float!
}

type Meal {
  id: ID!
  name: String!
  dateTime: String!
  instructions: String
  completedAt: String

  foods: [MealFood!]!
  logs: [MealLog!]!
  day: MealDay

  # Calculated totals from planned foods
  plannedCalories: Float!
  plannedProtein: Float!
  plannedCarbs: Float!
  plannedFat: Float!

  # Calculated totals from logged foods
  loggedCalories: Float!
  loggedProtein: Float!
  loggedCarbs: Float!
  loggedFat: Float!
}

type MealFood {
  id: ID!
  name: String!
  quantity: Float!
  unit: String!
  order: Int!

  # Nutritional information per 100g
  caloriesPer100g: Float
  proteinPer100g: Float
  carbsPer100g: Float
  fatPer100g: Float
  fiberPer100g: Float

  # Open Food Facts integration
  openFoodFactsId: String
  productData: String

  meal: Meal

  # Calculated nutrition for this specific quantity
  totalCalories: Float!
  totalProtein: Float!
  totalCarbs: Float!
  totalFat: Float!
  totalFiber: Float!
}

type MealLog {
  id: ID!
  loggedAt: String!
  completedAt: String

  meal: Meal
  user: UserPublic!
  items: [MealLogItem!]!

  # Calculated totals from logged items
  totalCalories: Float!
  totalProtein: Float!
  totalCarbs: Float!
  totalFat: Float!
}

type MealLogItem {
  id: ID!
  name: String!
  quantity: Float!
  unit: String!
  barcode: String

  # Nutritional data (calculated from quantity)
  calories: Float
  protein: Float
  carbs: Float
  fat: Float
  fiber: Float

  # Open Food Facts integration
  openFoodFactsId: String
  productData: String

  # Reference to planned food (if logging from plan)
  plannedFood: MealFood

  notes: String
  createdAt: String!

  log: MealLog
}

type MyMealPlansPayload {
  activePlan: MealPlan
  availablePlans: [MealPlan!]!
  completedPlans: [MealPlan!]!
}

type CreateMealPlanPayload {
  id: ID!
  success: Boolean!
}

# Queries
type Query {
  getMealPlanTemplates(draft: Boolean): [MealPlan!]!
  getMealPlanById(id: ID!): MealPlan!
  getClientMealPlans(clientId: ID!): [MealPlan!]!
  getClientActiveMealPlan(clientId: ID!): MealPlan
  getMyMealPlansOverview: MyMealPlansPayload!
}

# Mutations
type Mutation {
  createMealPlan(input: CreateMealPlanInput!): CreateMealPlanPayload!
  createDraftMealTemplate: MealPlan!
  updateMealPlan(input: UpdateMealPlanInput!): Boolean!
  deleteMealPlan(id: ID!): Boolean!
  duplicateMealPlan(id: ID!): ID!

  assignMealPlanToClient(input: AssignMealPlanToClientInput!): Boolean!
  removeMealPlanFromClient(planId: ID!, clientId: ID!): Boolean!

  activateMealPlan(planId: ID!, startDate: String!): Boolean!
  pauseMealPlan(planId: ID!): Boolean!
  completeMealPlan(planId: ID!): Boolean!

  # Food logging mutations
  logMealFood(input: LogMealFoodInput!): MealLogItem!
  updateMealFoodLog(input: UpdateMealFoodLogInput!): Boolean!
  deleteMealFoodLog(id: ID!): Boolean!

  # Granular update mutations
  updateMealPlanDetails(input: UpdateMealPlanDetailsInput!): Boolean!
  updateMealWeekDetails(input: UpdateMealWeekDetailsInput!): Boolean!
  updateMealDayData(input: UpdateMealDayDataInput!): Boolean!
  updateMeal(input: UpdateMealInput!): Boolean!
  updateMealFood(input: UpdateMealFoodInput!): Boolean!

  # Add/remove operations
  addMealToDay(input: AddMealToDayInput!): ID!
  removeMealFromDay(mealId: ID!): Boolean!
  addFoodToMeal(input: AddFoodToMealInput!): ID!
  removeFoodFromMeal(foodId: ID!): Boolean!
}

# Input Types
input CreateMealPlanInput {
  title: String!
  description: String
  isPublic: Boolean
  isDraft: Boolean
  dailyCalories: Float
  dailyProtein: Float
  dailyCarbs: Float
  dailyFat: Float
  weeks: [CreateMealWeekInput!]
}

input CreateMealWeekInput {
  weekNumber: Int!
  name: String!
  description: String
  days: [CreateMealDayInput!]
}

input CreateMealDayInput {
  dayOfWeek: Int!
  targetCalories: Float
  targetProtein: Float
  targetCarbs: Float
  targetFat: Float
  meals: [CreateMealInput!]
}

input CreateMealInput {
  name: String!
  dateTime: String!
  instructions: String
  foods: [CreateMealFoodInput!]
}

input CreateMealFoodInput {
  name: String!
  quantity: Float!
  unit: String!
  order: Int!
  caloriesPer100g: Float
  proteinPer100g: Float
  carbsPer100g: Float
  fatPer100g: Float
  fiberPer100g: Float
  openFoodFactsId: String
  productData: String
}

input UpdateMealPlanInput {
  id: ID!
  title: String
  description: String
  isPublic: Boolean
  isDraft: Boolean
  dailyCalories: Float
  dailyProtein: Float
  dailyCarbs: Float
  dailyFat: Float
  weeks: [UpdateMealWeekInput!]
}

input UpdateMealWeekInput {
  id: ID!
  weekNumber: Int!
  name: String
  description: String
  days: [UpdateMealDayInput!]
}

input UpdateMealDayInput {
  id: ID!
  dayOfWeek: Int!
  targetCalories: Float
  targetProtein: Float
  targetCarbs: Float
  targetFat: Float
  meals: [UpdateMealInput!]
}

input UpdateMealInput {
  id: ID!
  name: String
  dateTime: String
  instructions: String
  foods: [UpdateMealFoodInput!]
}

input UpdateMealFoodInput {
  id: ID!
  name: String
  quantity: Float
  unit: String
  order: Int
  caloriesPer100g: Float
  proteinPer100g: Float
  carbsPer100g: Float
  fatPer100g: Float
  fiberPer100g: Float
  openFoodFactsId: String
  productData: String
}

input AssignMealPlanToClientInput {
  planId: ID!
  clientId: ID!
  startDate: String
}

input LogMealFoodInput {
  mealId: ID!
  name: String!
  quantity: Float!
  unit: String!
  barcode: String
  calories: Float
  protein: Float
  carbs: Float
  fat: Float
  fiber: Float
  openFoodFactsId: String
  productData: String
  plannedFoodId: ID
  notes: String
}

input UpdateMealFoodLogInput {
  id: ID!
  quantity: Float
  notes: String
}

input UpdateMealPlanDetailsInput {
  id: ID!
  title: String
  description: String
  isPublic: Boolean
  isDraft: Boolean
  dailyCalories: Float
  dailyProtein: Float
  dailyCarbs: Float
  dailyFat: Float
}

input UpdateMealWeekDetailsInput {
  id: ID!
  name: String
  description: String
  weekNumber: Int
}

input UpdateMealDayDataInput {
  dayId: ID!
  targetCalories: Float
  targetProtein: Float
  targetCarbs: Float
  targetFat: Float
}

input AddMealToDayInput {
  dayId: ID!
  name: String!
  dateTime: String!
  instructions: String
}

input AddFoodToMealInput {
  mealId: ID!
  name: String!
  quantity: Float!
  unit: String!
  order: Int!
  caloriesPer100g: Float
  proteinPer100g: Float
  carbsPer100g: Float
  fatPer100g: Float
  fiberPer100g: Float
  openFoodFactsId: String
  productData: String
}
